<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Weather — Result</title>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --panel-bg: linear-gradient(145deg, #FCE0BC, #FFE6D1);
      --panel-shadow-inset: inset 0 2px 5px rgba(0,0,0,0.06);
      --panel-shadow: 0 6px 15px rgba(0,0,0,0.12);
    }

    html, body {
      margin: 0;
      height: 100%;
      font-family: 'Montserrat', sans-serif;
      color: #333;
      overflow: hidden;
    }

    body {
      position: relative;
      background-image: url('/static/images/homepagebg.jpg');
      background-size: cover;
      background-position: center;
    }

    body::before {
      content: "";
      position: absolute;
      inset: 0;
      background-color: rgba(255,255,255,0.35);
      z-index: 0;
    }

    .result-card {
      position: relative;
      z-index: 2;
      width: 720px;
      max-width: calc(100% - 40px);
      margin: 6vh auto 0;
      background: rgba(255,255,255,0);
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .panel {
      width: 100%;
      border-radius: 18px;
      padding: 26px;
      background: var(--panel-bg);
      box-shadow: var(--panel-shadow-inset), var(--panel-shadow);
      display: flex;
      gap: 24px;
      align-items: center;
    }

    .visual {
      width: 220px;
      height: 220px;
      min-width: 220px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .visual img.icon {
      width: 140px;
      height: 140px;
      display: block;
    }

    .visual .city-name {
      font-weight: 700;
      font-size: 20px;
      margin-top: 6px;
    }

    .visual .desc {
      font-size: 14px;
      opacity: .9;
    }

    .details {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
      justify-content: center;
    }

    .temp-big {
      font-size: 56px;
      font-weight: 800;
      line-height: 1;
    }

    .meta {
      font-size: 15px;
      opacity: .95;
    }

    .error {
      color: #b00020;
      font-weight: 600;
      margin-top: 8px;
    }

    .container {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 5vh;
      z-index: 2;
      text-align: center;
      pointer-events: none;
    }

    .bottom-panel {
      pointer-events: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      max-width: 920px;
      width: calc(100% - 40px);
      margin: auto;
    }

    form input[type="text"] {
      width: 560px;
      max-width: 100%;
      padding: 14px 18px;
      border-radius: 12px;
      border: none;
      text-align: center;
      font-size: 18px;
      background: var(--panel-bg);
      box-shadow: var(--panel-shadow-inset), var(--panel-shadow);
    }

    .locations {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .location-box {
      padding: 10px 14px;
      border-radius: 12px;
      background: var(--panel-bg);
      box-shadow: var(--panel-shadow-inset), var(--panel-shadow);
      cursor: pointer;
      user-select: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .location-box img.small-icon {
      width: 20px;
      height: 20px;
    }

    @media (max-width: 720px) {
      .panel { flex-direction: column; padding: 16px; }
      .visual { width: 100%; min-width: unset; height: 160px; }
      .visual img.icon { width: 110px; height: 110px; }
      .temp-big { font-size: 44px; }
      form input[type="text"] { width: 90%; }
    }
  </style>
</head>

<body>
  <a href="/" style="position:fixed; top:20px; left:20px; text-decoration:none; color:#33495f; font-weight:600; z-index:999;">
    Back to Home
  </a>

  <main class="result-card" role="main">
    <section class="panel" aria-live="polite">

      <div class="visual">
        {% if error %}
          <div class="city-name">Search result</div>
          <div class="desc">No location found</div>
        {% else %}
          {% if icon %}
            <img class="icon" src="https://openweathermap.org/img/wn/{{ icon }}@4x.png" alt="{{ wtype or '' }} icon">
          {% else %}
            <div style="width:140px;height:140px;border-radius:12px;background:rgba(0,0,0,0.06);display:flex;align-items:center;justify-content:center;font-weight:700;">N/A</div>
          {% endif %}
          <div class="city-name">{{ location or '—' }}</div>
          <div class="desc">{{ wtype or '—' }}</div>
        {% endif %}
      </div>

      {% if error %}
        <div class="error">{{ error }}</div>
      {% else %}

        <div class="temp-big" style="margin-top:-105px;">
          {% if celcius is not none %}
            {{ celcius|round(0) }}°C
          {% else %}
            — °C
          {% endif %}
        </div>

        <div class="meta" style="margin-top: 100px; margin-left: -155px;">
          {% if feels_like %}<div>Feels like: {{ feels_like|round(0) }}°C</div>{% endif %}
          {% if humidity %}<div>Humidity: {{ humidity }}%</div>{% endif %}
          {% if wind_speed %}<div>Wind: {{ wind_speed }} m/s</div>{% endif %}
          {% if rain_1h %}<div>Rain (1h): {{ rain_1h }} mm</div>{% endif %}
          {% if snow_1h %}<div>Snow (1h): {{ snow_1h }} mm</div>{% endif %}
          {% if sunrise %}<div>Sunrise: {{ sunrise | datetimeformat }}</div>{% endif %}
          {% if sunset %}<div>Sunset: {{ sunset | datetimeformat }}</div>{% endif %}
        </div>

      {% endif %}

    </section>
  </main>

  <div class="container">
    <div class="bottom-panel">
      <form method="POST" action="/weather" id="search-form">
        <input type="text" name="location" required>
      </form>

      <div class="locations">
        <div class="location-box" data-city="New York" onclick="selectLocation('New York')">New York</div>
        <div class="location-box" data-city="London" onclick="selectLocation('London')">London</div>
        <div class="location-box" data-city="Tokyo" onclick="selectLocation('Tokyo')">Tokyo</div>
        <div class="location-box" data-city="Paris" onclick="selectLocation('Paris')">Paris</div>
        <div class="location-box" data-city="Sydney" onclick="selectLocation('Sydney')">Sydney</div>
      </div>
    </div>
  </div>

  <script>
    function selectLocation(city) {
      const input = document.querySelector('input[name="location"]') ||
                    document.querySelector('#search-form input[name="location"]');
      if (!input) return;

      input.value = city;
      document.getElementById('search-form').submit();
    }

    (function populateQuickButtons() {
      const buttons = document.querySelectorAll('.location-box[data-city]');
      buttons.forEach(async (btn) => {
        const city = btn.dataset.city;
        try {
          const res = await fetch('/api/weather/' + encodeURIComponent(city));
          if (!res.ok) return;
          const data = await res.json();
          if (!data.weather || !data.weather[0]) return;

          const icon = data.weather[0].icon;
          const img = document.createElement('img');
          img.src = 'https://openweathermap.org/img/wn/' + icon + '.png';
          img.alt = data.weather[0].description || city;
          img.className = 'small-icon';
          btn.insertBefore(img, btn.firstChild);
        } catch (err) {}
      });
    })();
  </script>

</body>
</html>

